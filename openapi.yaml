openapi: 3.1.0
info:
  title: F1 Statistics API
  version: 1.2.0
  description: |
    REST API pro statistiky Formule 1 včetně webhooků.
    API je navrženo v souladu s REST standardy
    (path parametry, query parametry, žádné GET body).

servers:
  - url: http://172.20.10.7:8088
    description: Lokální server

paths:

  /api/v1/stats/drivers/{surname}:
    get:
      summary: Informace o jezdci
      parameters:
        - name: surname
          in: path
          required: true
          schema:
            type: string
            example: Alonso
      responses:
        "200":
          description: Jezdec nalezen
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Driver"

  /api/v1/stats/seasons:
    get:
      summary: Seznam sezón
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  example: "2004"

  /api/v1/stats/seasons/{season}/races:
    get:
      summary: Závody v sezóně
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
            example: 2004
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  1: {$ref: "#/components/schemas/Race"}

  /api/v1/stats/seasons/{season}/races/{round}/results:
    get:
      summary: Výsledky závodu
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
            example: 2004
        - name: round
          in: path
          required: true
          schema:
            type: integer
            example: 2
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  1: {$ref: "#/components/schemas/RaceResult"}

  /api/v1/stats/seasons/{season}/championships/drivers:
    get:
      summary: Pořadí jezdců
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
            example: 2006
        - name: round
          in: query
          required: false
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  1: {$ref: "#/components/schemas/DriverChampionship"}

  /api/v1/stats/seasons/{season}/championships/constructors:
    get:
      summary: Pořadí konstruktérů
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
            example: 2006
        - name: round
          in: query
          required: false
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  1: {$ref: "#/components/schemas/ConstructorChampionship"}

  /api/v1/stats/seasons/{season}/races/{round}/webhooks:
    post:
      summary: Webhook na výsledky závodu
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
        - name: round
          in: path
          required: true
          schema:
            type: integer
        - name: delayMs
          in: query
          required: false
          description: Interval zasílání dat (min. 500 ms, -1 = pouze jednou)
          schema:
            type: integer
            example: 1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WebhookRequest"
      responses:
        "200":
          description: Webhook zaregistrován

  /api/v1/stats/seasons/{season}/championships/drivers/webhooks:
    post:
      summary: Webhook na pořadí jezdců
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
        - name: delayMs
          in: query
          required: false
          schema:
            type: integer
            example: 1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WebhookRequest"
      responses:
        "200":
          description: Webhook zaregistrován

  /api/v1/stats/seasons/{season}/championships/constructors/webhooks:
    post:
      summary: Webhook na pořadí konstruktérů
      parameters:
        - name: season
          in: path
          required: true
          schema:
            type: integer
        - name: delayMs
          in: query
          required: false
          schema:
            type: integer
            example: 1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WebhookRequest"
      responses:
        "200":
          description: Webhook zaregistrován

  /dev/hooks:
    post:
      summary: Testovací webhook endpoint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Accepted

components:
  schemas:
    Driver:
      type: object
      properties:
        driverId:
          type: string
        driverRef:
          type: string
        number:
          type: string
        code:
          type: string
        forename:
          type: string
        surname:
          type: string
        dob:
          type: string
          format: date
        nationality:
          type: string
        url:
          type: string

    Race:
      type: object
      properties:
        name:
          type: string
        date:
          type: string
          format: date

    RaceResult:
      type: object
      properties:
        driver:
          type: string
        constructor:
          type: string
        grid:
          type: string

    DriverChampionship:
      type: object
      properties:
        driver:
          type: string
        points:
          type: string
        wins:
          type: string

    ConstructorChampionship:
      type: object
      properties:
        driver:
          type: string
        points:
          type: string
        wins:
          type: string

    WebhookRequest:
      type: object
      required:
        - callbackUrl
      properties:
        callbackUrl:
          type: string
          format: uri
